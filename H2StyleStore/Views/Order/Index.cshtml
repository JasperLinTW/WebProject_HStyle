@model IEnumerable<H2StyleStore.Models.ViewModels.OrderVM>

@{
    ViewBag.Title = "Index";
    IEnumerable<SelectListItem> statuslist = ViewBag.Status;
    IEnumerable<SelectListItem> pageSizeList = ViewBag.pageSizeList;
}



<h2 class="mt-2 mb-3">訂單管理</h2>

<div class="row mb-4 mr-2 donotprint">
    <div class="col-lg-12">
        <div class="caption">
            <div class="row">
                <div class="col-md-3">訂單狀態:@Html.DropDownList("status_id", statuslist, new { @class = "form-control" })</div>
                <div class="col-md-3">搜尋:@Html.TextBox("searchString", ViewBag.CurrentFilter as string, new { placeholder = "請輸入訂單編號、會員名稱", @class = "form-control" })</div>
                <div class="col-md-1 pt-4"><input type="submit" class="btn btn-primary" value="搜尋" onclick="search()" /></div>
            </div>
        </div>
    </div>
</div>
<label>每頁顯示: </label>@Html.DropDownList("pageSize", pageSizeList)<label>筆 </label>

<div id="OrderData">


</div>


@section Scripts {
    <script>

        $("#OrderData").on("change", "#pageSize", function () {
            search();
        });

         function search() {
            // 若 hash 沒資料，預設取第 1 頁
            // hash = #，瀏覽器解讀為位置識別符號
            // # 是用來指導瀏覽器動作的，對伺服器端完全無用。所以，HTTP請求中不包括 #
             var page = window.location.hash = 1;

            // 取資料
                 fetchPage(page);
             }


            var fetchPage = function (page) {
                // 準備搜尋條件資料
                var filter = {
                    searchString: $("#searchString").val(),
                    page: page,
                    pageSize: $("#pageSize").val(),
                    status_id: $("#status_id").val()
                }
                // Ajax 呼叫
                $.ajax({
                    url: '@Url.Action("PartialPage", "Order")',
                    data: filter,
                    type: 'Post',
                    success: function (resultHtml) {
                        // hash是指網頁最後的錨點，以#開頭
                        //取得資料後將目前 hash 重設
                        window.location.hash = page;

                        // 將 PartialView 資料寫入 div id="MemberDatas" 的區塊
                        $('#OrderData').html(resultHtml);
                        // 重設頁碼按鈕
                        $('#OrderData .pagination li a').each(function (i, item) {
                            // 若是有超連結的頁碼
                            var hyperLinkUrl = $(item).attr('href');
                            if (typeof hyperLinkUrl !== 'undefined' && hyperLinkUrl !== false) {
                                // 取得當前按鈕(<a>)的對應頁碼
                                var pageNumber = $(item).text();
                                // 將頁碼按鈕的 href 去除
                                $(item).attr('href', '#');
                                // 設定按下頁碼事件
                                $(item).click(function (event) {
                                    // 取消<a>標籤原始的連結功能
                                    event.preventDefault();
                                    // 取得按下的頁碼的資料
                                    fetchPage(pageNumber);
                                });
                            }
                        });
                    }
                });
        };

       //載入時先進行一次search才有初始畫面
        search();
    </script>


}
